<!DOCTYPE html><html lang="zh-cn" class="theme-o2 page-post-detail"><head prefix="og: http://ogp.me/ns#"><meta charset="utf-8"><title>手把手教你搭建ngrok服务－轻松外网调试本机站点 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="keywords" content="调试,反向代理,ngrok,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="http://aotu.io/notes/2016/02/19/ngrok/index.html"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="/assets/img/favicon-230x230.png" sizes="230x230"><link rel="icon" type="image/png" href="/assets/img/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/assets/img/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="/assets/img/favicon-32x32.png" sizes="32x32"><meta name="msapplication-TileColor" content="#2f83cd"><meta name="msapplication-TileImage" content="/assets/img/mstile-144x144.png"><link rel="stylesheet" href="/assets/css/dist-c41d9f085d.o2.css"><link rel="stylesheet" href="/assets/fancybox/jquery.fancybox.css"><link rel="alternate" href="/atom.xml" title="Aotu.io「凹凸实验室」"><meta name="description" content="半年多没用ngrok，然后昨天发现它被墙了，艸～。"><meta property="og:type" content="article"><meta property="og:title" content="手把手教你搭建ngrok服务－轻松外网调试本机站点"><meta property="og:url" content="http://aotu.io/notes/2016/02/19/ngrok/index.html"><meta property="og:site_name" content="Aotu.io「凹凸实验室」"><meta property="og:description" content="半年多没用ngrok，然后昨天发现它被墙了，艸～。"><meta property="og:image" content="http://aotu.io/img/post/mamboer/ngrok-demo.jpg"><meta property="og:image" content="http://aotu.io/img/post/mamboer/ngrok-demo1.jpg"><meta property="og:updated_time" content="2016-03-31T02:31:36.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="手把手教你搭建ngrok服务－轻松外网调试本机站点"><meta name="twitter:description" content="半年多没用ngrok，然后昨天发现它被墙了，艸～。"><meta name="twitter:image" content="http://aotu.io/img/post/mamboer/ngrok-demo.jpg"><meta name="twitter:site" content="o2circle"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>var App={root:"/"}</script><body itemscope itemtype="http://schema.org/WebPage"><div class="navbar navbar-fixed-top header" itemscope itemtype="http://schema.org/WPHeader"><div class="container"><div class="navbar-header"><a href="/index.html" title="Aotu.io「凹凸实验室」" class="navbar-brand"><img src="/assets/img/logo_186x65.png" alt="Aotu.io「凹凸实验室」"></a><div onclick="" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></div></div><div class="navbar-collapse collapse" id="navbar-main"><ul class="nav navbar-nav header-links header-links-main"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a><li class="main-nav-item active"><a href="/notes/" class="main-nav-link">博客</a><li class="main-nav-item"><a href="/tags/" class="main-nav-link">标签</a><li class="main-nav-item"><a href="http://aotu.io/brand/" class="main-nav-link">品牌</a><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></ul><ul class="nav navbar-nav navbar-right header-links header-links-extra"><li class="search-wrap"><a class="fa fa-search search-icon" href="#search" title="搜索"></a><form id="search" method="get" class="search-form"><input type="text" name="query" class="search-form-ipt" placeholder="搜索"></form><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;" id="themes" aria-expanded="false">主题&nbsp;<span class="caret"></span></a><ul id="theme-list" class="dropdown-menu" aria-labelledby="themes"><li data-v="light"><a href="javascript:;">曙光女神</a><li data-v="dark"><a href="javascript:;">暗影猎手</a></ul></ul></div></div></div><div class="container post-wrap"><article class="post" itemscope itemtype="http://schema.org/Article"><header class="post-header"><div class="post-title"><h2><a href="/notes/2016/02/19/ngrok/" itemprop="name">手把手教你搭建ngrok服务－轻松外网调试本机站点</a></h2><ul class="post-stats"><li><a href="/tags/ngrok/" class="meta-tag">ngrok</a><li><a href="/tags/反向代理/" class="meta-tag">反向代理</a><li><a href="/tags/调试/" class="meta-tag">调试</a><li title="字数"><span class="icon fa-font">4,380</span><li id="busuanzi_container_page_pv" title="热度"><span class="icon fa-eye" id="busuanzi_value_page_pv"></span><li><a href="/notes/2016/02/19/ngrok/#comments" itemprop="discussionUrl" class="lnk-comments"><span class="post-comments-count ds-thread-count icon fa-comments" data-thread-key="bm90ZXMvMjAxNi8wMi8xOS9uZ3Jvay8=" data-count-type="comments" itemprop="commentsCount">0</span></a></ul><p>ngrok的核心功能：能够将你本机的HTTP服务（站点）或TCP服务，通过部署有ngrok服务的外网伺服器暴露给外网访问！</div><div class="post-meta"><time class="published" datetime="2016-02-18T17:55:35.000Z" itempro="datePublished">星期四, 2月18日 2016</time> <a target="_blank" href="https://github.com/mamboer" class="author"><span class="name">LV主唱大人</span><img src="https://avatars.githubusercontent.com/mamboer?v=3&s=80" alt="mamboer"></a></div></header><a href="/notes/2016/02/19/ngrok/" class="image featured post-cover"><img src="/assets/img/post/mamboer/ngrok.jpg" alt="手把手教你搭建ngrok服务－轻松外网调试本机站点"></a><div class="post-content" itemprop="articleBody" data-swiftype-index="true"><p>半年多没用ngrok，然后昨天发现它被墙了，艸～。</p><a id="more"></a><h2 id="ngrok是什么鬼？" class="post-heading"><a href="#ngrok是什么鬼？" class="headerlink" title="ngrok是什么鬼？"></a>ngrok是什么鬼？<a class="post-anchor" href="#ngrok是什么鬼？" aria-hidden="true"></a></h2><p>做前端开发的童鞋或许不会太陌生。<br>如果你完全不知道它是什么东西，可以在它的github项目上了解下：<a href="https://github.com/inconshreveable/ngrok" target="_blank" rel="external">https://github.com/inconshreveable/ngrok</a><br>这里只提下它的核心功能：能够将你本机的HTTP服务（站点）或TCP服务，通过部署有ngrok服务的外网伺服器暴露给外网访问！<p>如上封面图所示，举一个栗子。<ol><li>橘色屏幕的笔记本是你的工作机器，安装了ngrok客户端<li>ngrok.com所在的服务器安装了ngrok的服务端（ngrokd）<li>利用ngrok 8080命令可以将你本机的8080端口暴露给反向代理至ngrok.com的某个二级域名如：xxx.ngrok.com<li>别人通过xxx.ngrok.com就可以访问你本机8080端口上的站点内容了。</ol><p>由此可见，除了Weinre、browsersync 这些惯用的手段外，借助ngrok，也一样可以解决前端开发过程经常遇到的“本地开发，外网调试”老大难题。<p>囧的是：ngrok.com被墙了，我们已无法用它官方的服务～<br>国内虽然有一些第三方的ngrok服务，但是也无法保证其稳定性。<br>还好ngrok是开源的，我们可以通过它的源码在自己的外网服务器上搭建自己的ngrok服务。<p>前提条件是：一台外网可访问的主机，且有域名解析至该主机上。<h2 id="搭建服务端ngrokd" class="post-heading"><a href="#搭建服务端ngrokd" class="headerlink" title="搭建服务端ngrokd"></a>搭建服务端ngrokd<a class="post-anchor" href="#搭建服务端ngrokd" aria-hidden="true"></a></h2><h3 id="1-安装go语言开发环境" class="post-heading"><a href="#1-安装go语言开发环境" class="headerlink" title="1.安装go语言开发环境"></a>1.安装go语言开发环境<a class="post-anchor" href="#1-安装go语言开发环境" aria-hidden="true"></a></h3><p>ngrok是利用go语言开发的，所以先要在服务器上安装go语言开发环境。<br>以CentOS的服务器示例，安装Go语言很简单的：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">sudo yum install golang</span><br></pre></table></figure><p>安装完毕后，利用go version来验证是否安装成功。<br>go安装好后，我们再设置下go的环境变量：<p>在<code>~/.zshrc</code>或<code>~/.bash_profile</code>文件内，加入以下环境变量配置内容：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/go</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/.local/bin:<span class="variable">$HOME</span>/bin:<span class="variable">$GOPATH</span>/bin</span><br></pre></table></figure><p>保存后，重新给shell加载下配置文件：<code>source ~/.zshrc</code><p>最后可通过go env查看是否配置成功。<h3 id="2-安装git" class="post-heading"><a href="#2-安装git" class="headerlink" title="2.安装git"></a>2.安装git<a class="post-anchor" href="#2-安装git" aria-hidden="true"></a></h3><p>安装过程略。后面我们需要利用git拉取源码。<h3 id="3-fork并拉取ngrok的源码" class="post-heading"><a href="#3-fork并拉取ngrok的源码" class="headerlink" title="3.fork并拉取ngrok的源码"></a>3.fork并拉取ngrok的源码<a class="post-anchor" href="#3-fork并拉取ngrok的源码" aria-hidden="true"></a></h3><p>下面编译过程需要改官方的部分源码，所以最好fork一份源码至自己的github账户。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre><td class="code"><pre><span class="line">$ mkdir -p ~/go/src/github.com/mamboer</span><br><span class="line">$ <span class="built_in">cd</span> ~/go/src/github.com/mamboer</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/mamboer/ngrok.git</span><br></pre></table></figure><p>源码拉取下来后，需要修改一个地方：<br>打开<code>src/ngrok/log/logger.go</code>文件<br>将<code>code.google.com/p/log4go</code> 修改为：<code>github.com/alecthomas/log4go</code><p>googlecode已经寿终了，我们将依赖的log4go替换成github的版本。<p>在编译ngrok的源码之前，我们还需要改下官方源码用到的签名证书。<h3 id="4-生成自签名证书" class="post-heading"><a href="#4-生成自签名证书" class="headerlink" title="4.生成自签名证书"></a>4.生成自签名证书<a class="post-anchor" href="#4-生成自签名证书" aria-hidden="true"></a></h3><p>使用ngrok.com官方服务时，我们使用的是官方的SSL证书。自建ngrokd服务，如果不想买SSL证书，我们需要生成自己的自签名证书，并编译一个携带该证书的ngrok客户端。<p>证书生成过程需要一个NGROK_BASE_DOMAIN。 以ngrok官方随机生成的地址693c358d.ngrok.com为例，其NGROK_BASE_DOMAIN就是”ngrok.com”，如果你要 提供服务的地址为”example.ngrok.xxx.com”，那NGROK_BASE_DOMAIN就应该 是”ngrok.xxx.com”。<p>我们这里以NGROK_BASE_DOMAIN=“ngrok.fex.im”为例，生成证书的命令如下：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ngrok</span><br><span class="line">$ openssl genrsa -out rootCA.key 2048</span><br><span class="line">$ openssl req -x509 -new -nodes -key rootCA.key -subj <span class="string">"/CN=ngrok.fex.im"</span> -days 5000 -out rootCA.pem</span><br><span class="line">$ openssl genrsa -out device.key 2048</span><br><span class="line">$ openssl req -new -key device.key -subj <span class="string">"/CN=ngrok.fex.im"</span> -out device.csr</span><br><span class="line">$ openssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000</span><br></pre></table></figure><p>执行完以上命令，在ngrok目录下就会新生成6个文件：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre><td class="code"><pre><span class="line"><span class="selector-tag">-rw-rw-r--</span> 1 <span class="selector-tag">lv</span> <span class="selector-tag">lv</span>  985 <span class="selector-tag">Feb</span> 17 19<span class="selector-pseudo">:04</span> <span class="selector-tag">device</span><span class="selector-class">.crt</span></span><br><span class="line"><span class="selector-tag">-rw-rw-r--</span> 1 <span class="selector-tag">lv</span> <span class="selector-tag">lv</span>  895 <span class="selector-tag">Feb</span> 17 19<span class="selector-pseudo">:04</span> <span class="selector-tag">device</span><span class="selector-class">.csr</span></span><br><span class="line"><span class="selector-tag">-rw-rw-r--</span> 1 <span class="selector-tag">lv</span> <span class="selector-tag">lv</span> 1679 <span class="selector-tag">Feb</span> 17 19<span class="selector-pseudo">:03</span> <span class="selector-tag">device</span><span class="selector-class">.key</span></span><br><span class="line"><span class="selector-tag">-rw-rw-r--</span> 1 <span class="selector-tag">lv</span> <span class="selector-tag">lv</span> 1675 <span class="selector-tag">Feb</span> 17 19<span class="selector-pseudo">:01</span> <span class="selector-tag">rootCA</span><span class="selector-class">.key</span></span><br><span class="line"><span class="selector-tag">-rw-rw-r--</span> 1 <span class="selector-tag">lv</span> <span class="selector-tag">lv</span> 1103 <span class="selector-tag">Feb</span> 17 19<span class="selector-pseudo">:03</span> <span class="selector-tag">rootCA</span><span class="selector-class">.pem</span></span><br><span class="line"><span class="selector-tag">-rw-rw-r--</span> 1 <span class="selector-tag">lv</span> <span class="selector-tag">lv</span>   17 <span class="selector-tag">Feb</span> 17 19<span class="selector-pseudo">:04</span> <span class="selector-tag">rootCA</span><span class="selector-class">.srl</span></span><br></pre></table></figure><p>ngrok通过bindata将ngrok源码目录下的assets目录（资源文件）打包到可执行文件(ngrokd和ngrok)中 去，assets/client/tls和assets/server/tls下分别存放着用于ngrok和ngrokd的默认证书文件，我们需要将它们替换成我们自己生成的：(因此这一步务必放在编译可执行文件之前)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre><td class="code"><pre><span class="line">cp rootCA.pem assets/client/tls/ngrokroot.crt</span><br><span class="line">cp device.crt assets/server/tls/snakeoil.crt</span><br><span class="line">cp device.key assets/server/tls/snakeoil.key</span><br></pre></table></figure><h3 id="5-编译客户端程序ngrok和服务端程序ngrokd" class="post-heading"><a href="#5-编译客户端程序ngrok和服务端程序ngrokd" class="headerlink" title="5.编译客户端程序ngrok和服务端程序ngrokd"></a>5.编译客户端程序ngrok和服务端程序ngrokd<a class="post-anchor" href="#5-编译客户端程序ngrok和服务端程序ngrokd" aria-hidden="true"></a></h3><p>在ngrok目录下执行如下命令，编译ngrokd：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">$ make release-server</span><br></pre></table></figure><p>类似的，利用以下命令编译ngrok:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">$ make release-client</span><br></pre></table></figure><p>成功编译后，会在bin目录下找到<code>ngrokd</code>和<code>ngrok</code>这两个文件。<p>我们将ngrokd文件拷贝至<code>~/go/bin</code>目录下，以方便在其他目录内也可以直接通过ngrokd来访问该执行程序。<h3 id="6-运行ngrokd服务" class="post-heading"><a href="#6-运行ngrokd服务" class="headerlink" title="6.运行ngrokd服务"></a>6.运行ngrokd服务<a class="post-anchor" href="#6-运行ngrokd服务" aria-hidden="true"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre><td class="code"><pre><span class="line">ngrokd -domain=<span class="string">"ngrok.fex.im"</span> -httpAddr=<span class="string">":8088"</span> -httpsAddr=<span class="string">":8089"</span></span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.(*PrefixLogger).Info:83) [registry] [tun] No affinity cache specified</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.(*PrefixLogger).Info:83) [metrics] Reporting every 30 seconds</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.Info:112) Listening <span class="keyword">for</span> public http connections on [::]:8088</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.Info:112) Listening <span class="keyword">for</span> public https connections on [::]:8089</span><br><span class="line">[15:08:52 CST 2016/02/18] [INFO] (ngrok/log.Info:112) Listening <span class="keyword">for</span> control and proxy connections on [::]:4443</span><br></pre></table></figure><h3 id="7-为ngrok-fex-im添加dns解析" class="post-heading"><a href="#7-为ngrok-fex-im添加dns解析" class="headerlink" title="7.为ngrok.fex.im添加dns解析"></a>7.为ngrok.fex.im添加dns解析<a class="post-anchor" href="#7-为ngrok-fex-im添加dns解析" aria-hidden="true"></a></h3><p>添加两条A记录：<code>ngrok.fex.im</code>和<code>*.ngrok.fex.im</code>，指向fex.im所在的服务器ip。<p>至此为止，我们的ngrokd服务端搭建配置完成，同时我们在CentOS系统的服务器上编译了一份客户端的执行程序－一个ngrok文件。<br>如果你的开发机器系统也是CentOS，是可以直接将ngrok这个客户端执行文件拷贝到本地开发机器中来使用的。<br>但如果你的机器是Mac 或者windows，我们还需要在自己的电脑中编译一份相同签名文件的客户端程序！<p>注意：请记得提交已更改的源码至github，一会还要用到。<h2 id="在MAC中编译ngrok客户端" class="post-heading"><a href="#在MAC中编译ngrok客户端" class="headerlink" title="在MAC中编译ngrok客户端"></a>在MAC中编译ngrok客户端<a class="post-anchor" href="#在MAC中编译ngrok客户端" aria-hidden="true"></a></h2><p>服务器是CentOS，自己的工作电脑是Mac，所以得在自己的电脑中编译一份相同签名文件的客户端程序！<h3 id="1-安装go" class="post-heading"><a href="#1-安装go" class="headerlink" title="1.安装go"></a>1.安装go<a class="post-anchor" href="#1-安装go" aria-hidden="true"></a></h3><p>与服务器的步骤类似，我们首先要安装go语言环境：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install go</span><br></pre></table></figure><h3 id="2-设置go的环境变量（略）" class="post-heading"><a href="#2-设置go的环境变量（略）" class="headerlink" title="2.设置go的环境变量（略）"></a>2.设置go的环境变量（略）<a class="post-anchor" href="#2-设置go的环境变量（略）" aria-hidden="true"></a></h3><h3 id="3-拉取源码并编译客户端（略）" class="post-heading"><a href="#3-拉取源码并编译客户端（略）" class="headerlink" title="3.拉取源码并编译客户端（略）"></a>3.拉取源码并编译客户端（略）<a class="post-anchor" href="#3-拉取源码并编译客户端（略）" aria-hidden="true"></a></h3><p>最后将编译好的ngrok文件，拷贝至$GOPATH/bin目录内，以便在命令行内任意目录内均可以直接通过ngrok运行程序。<h2 id="最后的验证" class="post-heading"><a href="#最后的验证" class="headerlink" title="最后的验证"></a>最后的验证<a class="post-anchor" href="#最后的验证" aria-hidden="true"></a></h2><p>ngrokd服务配置好了，客户端程序也有了，下面测试下ngrok是否能够正常使用。<ol><li><p>创建一个ngrok配置文件：ngrok.cfg<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line">server_addr: “ngrok.fex.im:4443<span class="string">"</span><br><span class="line">trust_host_root_certs: false</span></span><br></pre></table></figure><li><p>运行客户端，暴露8080端口的站点<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">$ ngrok -subdomain demo -config=/Users/lv/bin/ngrok.cfg 8080</span><br></pre></table></figure><li><p>在8080端口下建一个测试站点<p>方便起见，我们拉取git@github.com:o2team/brand.git做测试：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre><td class="code"><pre><span class="line">npm i -g node-static</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:o2team/brand.git</span><br><span class="line"><span class="built_in">cd</span> brand</span><br><span class="line">static</span><br></pre></table></figure><li><p>在浏览器中输入demo.ngrok.fex.im:8088<p>bingo!<p class="user_img"><img src="/assets/img/post/mamboer/ngrok-demo.jpg"><li><p>在浏览器中输入：localhost:4040<p>可以查看所有的请求情况！<p class="user_img"><img src="/assets/img/post/mamboer/ngrok-demo1.jpg"></ol><h2 id="注意事项" class="post-heading"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项<a class="post-anchor" href="#注意事项" aria-hidden="true"></a></h2><p>客户端ngrok.cfg中server_addr后的值必须严格与-domain以及证书中的<code>NGROK_BASE_DOMAIN</code>相同，否则Server端就会出现如下错误日志：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre><td class="code"><pre><span class="line"><span class="selector-attr">[03/13/15 09:55:46]</span> <span class="selector-attr">[INFO]</span> <span class="selector-attr">[tun:15dd7522]</span> <span class="selector-tag">New</span> <span class="selector-tag">connection</span> <span class="selector-tag">from</span> 54<span class="selector-class">.149</span><span class="selector-class">.100</span><span class="selector-class">.42</span><span class="selector-pseudo">:38252</span></span><br><span class="line"><span class="selector-attr">[03/13/15 09:55:46]</span> <span class="selector-attr">[DEBG]</span> <span class="selector-attr">[tun:15dd7522]</span> <span class="selector-tag">Waiting</span> <span class="selector-tag">to</span> <span class="selector-tag">read</span> <span class="selector-tag">message</span></span><br><span class="line"><span class="selector-attr">[03/13/15 09:55:46]</span> <span class="selector-attr">[WARN]</span> <span class="selector-attr">[tun:15dd7522]</span> <span class="selector-tag">Failed</span> <span class="selector-tag">to</span> <span class="selector-tag">read</span> <span class="selector-tag">message</span>: <span class="selector-tag">remote</span> <span class="selector-tag">error</span>: <span class="selector-tag">bad</span> <span class="selector-tag">certificate</span></span><br><span class="line"><span class="selector-attr">[03/13/15 09:55:46]</span> <span class="selector-attr">[DEBG]</span> <span class="selector-attr">[tun:15dd7522]</span> <span class="selector-tag">Closing</span></span><br></pre></table></figure><h2 id="参考资料" class="post-heading"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料<a class="post-anchor" href="#参考资料" aria-hidden="true"></a></h2><ul><li>自建ngrok服务</ul><ol><li><a href="http://tonybai.com/2015/03/14/selfhost-ngrok-service/" target="_blank" rel="external">http://tonybai.com/2015/03/14/selfhost-ngrok-service/</a><li><a href="https://github.com/inconshreveable/ngrok/blob/master/docs/SELFHOSTING.md" target="_blank" rel="external">https://github.com/inconshreveable/ngrok/blob/master/docs/SELFHOSTING.md</a></ol><ul><li>go的安装</ul><ol><li><a href="https://blog.starkandwayne.com/2014/12/04/how-to-install-go-on-digital-ocean/" target="_blank" rel="external">https://blog.starkandwayne.com/2014/12/04/how-to-install-go-on-digital-ocean/</a></ol><h2 id="结语" class="post-heading"><a href="#结语" class="headerlink" title="结语"></a>结语<a class="post-anchor" href="#结语" aria-hidden="true"></a></h2><p>本文主要介绍了ngrok服务的自行搭建。同时为大家免费提供我搭建好的ngrok服务：ngrok.fex.im。<br>fex.im所在的机器是digitalocean的一个主机，虽然国内速度慢但是还算稳定。<h2 id="如何使用ngrok-fex-im" class="post-heading"><a href="#如何使用ngrok-fex-im" class="headerlink" title="如何使用ngrok.fex.im?"></a>如何使用ngrok.fex.im?<a class="post-anchor" href="#如何使用ngrok-fex-im" aria-hidden="true"></a></h2><h3 id="安装client" class="post-heading"><a href="#安装client" class="headerlink" title="安装client"></a>安装client<a class="post-anchor" href="#安装client" aria-hidden="true"></a></h3><p>Linux 下载:<a href="http://fex.im/files/ngrok" target="_blank" rel="external">http://fex.im/files/ngrok</a><br>Mac OSX 下载：<a href="https://github.com/mamboer/ngrok/releases/download/1.7.2/ngrok" target="_blank" rel="external">https://github.com/mamboer/ngrok/releases/download/1.7.2/ngrok</a><p>放在 <code>/usr/local/bin</code> 目录下<h3 id="设置所有者" class="post-heading"><a href="#设置所有者" class="headerlink" title="设置所有者"></a>设置所有者<a class="post-anchor" href="#设置所有者" aria-hidden="true"></a></h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">sudo chown <span class="variable">$(</span>whoami)<span class="symbol">:staff</span> ngrok</span><br></pre></table></figure><h3 id="设置权限" class="post-heading"><a href="#设置权限" class="headerlink" title="设置权限"></a>设置权限<a class="post-anchor" href="#设置权限" aria-hidden="true"></a></h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">sudo <span class="keyword">chmod</span> <span class="number">777</span> ngrok</span><br></pre></table></figure><h3 id="运行客户端" class="post-heading"><a href="#运行客户端" class="headerlink" title="运行客户端"></a>运行客户端<a class="post-anchor" href="#运行客户端" aria-hidden="true"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre><td class="code"><pre><span class="line">$ ngrok -subdomain demo -config=/Users/lv/bin/ngrok.cfg 8080</span><br></pre></table></figure><h3 id="配置文件" class="post-heading"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件<a class="post-anchor" href="#配置文件" aria-hidden="true"></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line">server_addr: “ngrok.fex.im:4443<span class="string">"</span><br><span class="line">trust_host_root_certs: false</span></span><br></pre></table></figure></div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2016-03-31T02:31:36.000Z" itemprop="dateModified">上次更新：星期四, 3月31日 2016 02:31:36</time></div><div class="actions pagination pagination-post"><div class="pagination-post-prev"><a href="/notes/2016/02/24/node-debug-in-production/" class="button big" title="Node 生产环境调试"><i class="fa fa-chevron-left"></i> Node 生产环境调试</a></div><div class="pagination-post-next"><a href="/notes/2016/01/28/3xx-of-http-status/" class="button big" title="你所知道的3xx状态码">你所知道的3xx状态码 <i class="fa fa-chevron-right"></i></a></div></div><div class="post-comments" id="comments"><div class="ds-thread" data-thread-key="bm90ZXMvMjAxNi8wMi8xOS9uZ3Jvay8=" data-title="手把手教你搭建ngrok服务－轻松外网调试本机站点" data-url="http://aotu.io/notes/2016/02/19/ngrok/index.html"></div><script>var duoshuoQuery={short_name:"aotu"};!function(){var t=document.createElement("script");t.id="duoshuo-script",t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script></div></article></div><div class="sec sec-follow-lite"><div class="container"><div class="sec-heading"><p class="follow-pic"><img src="/assets/img/qrcode.png" alt="关注我们"><p class="follow-desc">海海人生，无折腾不为乐。<p class="sec-heading-sub follow-acount"><img class="follow-icon" src="/assets/img/logo-circle-120.png" alt="AOTULabs"> 微信号：AOTULabs</div></div></div><div class="sec sec-footer"><div class="container"><footer id="footer" class="sec-heading footer"><ul class="icons"><li><a href="https://twitter.com/o2circle" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a><li><a href="/atom.xml" class="footer-link fa-rss"><span class="label">RSS</span></a><li><a href="https://github.com/o2team/o2team.github.io" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a></ul><div class="footer-sec copyright">&copy; 2016 <a href="http://aotu.io" target="_blank">凹凸实验室</a><br>Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.</div><div class="footer-sec words">" It is never too late to mend. "</div><div class="footer-sec site-stats" style="display:none"><span id="busuanzi_container_site_pv" class="site-pv">总访问量: <span id="busuanzi_value_site_pv" class="site-pv-num"></span> 次 </span><span id="busuanzi_container_site_uv" class="site-uv">总访客数: <span id="busuanzi_value_site_uv" class="site-uv-num"></span> 人</span></div></footer></div></div><section id="smSearch" class="slide-search"><section><form class="search" method="get"><input type="text" name="query" placeholder="搜索"></form></section><section><h3>搜索结果</h3><ul class="links" id="searchResults">Loading...</ul></section></section><script id="tplSearch" type="text/hogan-tpl">{{#items}}
    <li>
        <a href="{{ url }}" target="_blank">
            <h3>{{ title }}</h3>
            {{#desc}}
			<p>{{ desc }}</p>
			{{/desc}}
        </a>
    </li>
    {{/items}}</script><div class="back-to-top" id="backTop"><i class="fa fa-long-arrow-up"></i></div><script src="/assets/js/dist-2a84b65682.o2.js"></script><script src="/assets/js/dist-bb2f97f6a9.duoshuo.js"></script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>!function(){var e=document.createElement("script");e.src="//push.zhanzhang.baidu.com/push.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>