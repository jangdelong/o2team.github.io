<!DOCTYPE html>
<html lang="zh-cn" class="theme-o2 page-post-detail">
<head prefix="og: http://ogp.me/ns#">
    <meta charset="utf-8"/>
	<title>PostCSS快速入门使用 | Aotu.io「凹凸实验室」</title>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
  	<meta name="apple-touch-fullscreen" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black"/> 
    <!-- keywords -->
<meta name="keywords" content="PostCSS,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"/>
<!-- Canonical links -->
<link rel="canonical" href="http://aotu.io/notes/2015/10/13/start-postcss/index.html">
<!-- Alternative links -->

<!-- Icon -->
<link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/img/favicon-230x230.png" sizes="230x230">
<link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#2f83cd">
<meta name="msapplication-TileImage" content="/img/mstile-144x144.png">
<!-- CSS -->
<!-- build:css css/dist.o2.css -->
<link rel="stylesheet" href="/css/o2.css">
<!-- endbuild -->

<link rel="stylesheet" href="/assets/fancybox/jquery.fancybox.css">

<!-- RSS -->
<link rel="alternate" href="/atom.xml" title="Aotu.io「凹凸实验室」">
<!-- Open Graph -->
<meta name="description" content="初识PostCSS如果你第一次听说PostCSS这个东西，那么请看下面摘自官方Github的介绍：

PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, a">
<meta property="og:type" content="article">
<meta property="og:title" content="PostCSS快速入门使用">
<meta property="og:url" content="http://aotu.io/notes/2015/10/13/start-postcss/index.html">
<meta property="og:site_name" content="Aotu.io「凹凸实验室」">
<meta property="og:description" content="初识PostCSS如果你第一次听说PostCSS这个东西，那么请看下面摘自官方Github的介绍：

PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, a">
<meta property="og:image" content="http://aotu.io/img/post/cnt1992/postcss.png">
<meta property="og:updated_time" content="2016-03-31T02:31:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PostCSS快速入门使用">
<meta name="twitter:description" content="初识PostCSS如果你第一次听说PostCSS这个东西，那么请看下面摘自官方Github的介绍：

PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, a">
<meta name="twitter:image" content="http://aotu.io/img/post/cnt1992/postcss.png">
<meta name="twitter:site" content="o2circle">
<!-- Baidu Analytics -->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script>
var App = {
    root:'/'    
};
</script>

</head>
<body itemscope itemtype="http://schema.org/WebPage">
    
    <div class="navbar navbar-fixed-top header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="container">
        <div class="navbar-header">
            <a href="/index.html" title="Aotu.io「凹凸实验室」" class="navbar-brand">
                <img src="/img/logo_186x65.png" alt="Aotu.io「凹凸实验室」"/>
            </a>
            <div onclick="javascript:void(0)" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </div>
        </div>
        <div class="navbar-collapse collapse" id="navbar-main">
            <ul class="nav navbar-nav header-links header-links-main">
                <li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item active"><a href="/notes/" class="main-nav-link">博客</a></li><li class="main-nav-item"><a href="/tags/" class="main-nav-link">标签</a></li><li class="main-nav-item"><a href="http://aotu.io/brand/" class="main-nav-link">品牌</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right header-links header-links-extra">
                <li class="search-wrap">
                    <a class="fa fa-search search-icon" href="#search" title="搜索"></a>
                    <form id="search" method="get" class="search-form">
                        <input type="text" name="query" class="search-form-ipt" placeholder="搜索" />
                    </form>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;" id="themes" aria-expanded="false">主题&nbsp;<span class="caret"></span></a>
                    <ul id="theme-list" class="dropdown-menu" aria-labelledby="themes">
                        <li data-v="light"><a href="javascript:;">曙光女神</a></li>
                        <li data-v="dark"><a href="javascript:;">暗影猎手</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

    
	
<div class="container post-wrap">
    
    <!-- Post -->
<article class="post" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <div class="post-title">
            <h2><a href="/notes/2015/10/13/start-postcss/" itemprop="name">PostCSS快速入门使用</a></h2>
            <ul class="post-stats">
                
                
                <li><a href='/tags/PostCSS/' class='meta-tag'>PostCSS</a></li>
                 
                
                <li title="字数"><span class="icon fa-font">5,747</span></li>
                
                <li id="busuanzi_container_page_pv" title="热度"><span class="icon fa-eye" id="busuanzi_value_page_pv"></span></li>
                
                
                <li>
                    <a href="/notes/2015/10/13/start-postcss/#comments" itemprop="discussionUrl" class="lnk-comments">
                        <span class="post-comments-count ds-thread-count icon fa-comments" data-thread-key="bm90ZXMvMjAxNS8xMC8xMy9zdGFydC1wb3N0Y3NzLw==" data-count-type="comments" itemprop="commentsCount">0</span>
                    </a>
                </li>
                 
            </ul>
            
            <p>PostCSS 是一套利用JS插件实现的用来改变CSS的工具.这些插件能够支持变量和混合语法，转换未来CSS语法，内联图片，还有更多</p>
            
        </div>
        <div class="post-meta">
            <time class="published" datetime="2015-10-13T09:34:25.000Z" itempro="datePublished">星期二, 10月13日 2015</time>
            <a target="_blank" href="https://github.com/cnt1992" class="author"><span class="name">Sky</span><img src="https://avatars.githubusercontent.com/cnt1992?v=3&s=80" alt="cnt1992" /></a>
        </div>
    </header>
    <a href="/notes/2015/10/13/start-postcss/" class="image featured post-cover"><img src="/img/post/cnt1992/postcss.jpg" alt="PostCSS快速入门使用" /></a>
    <div class="post-content" itemprop="articleBody" data-swiftype-index="true">
        <h2 id="初识PostCSS" class="post-heading"><a href="#初识PostCSS" class="headerlink" title="初识PostCSS"></a>初识PostCSS<a class="post-anchor" href="#初识PostCSS" aria-hidden="true"></a></h2><p>如果你第一次听说<code>PostCSS</code>这个东西，那么请看下面摘自官方<code>Github</code>的介绍：</p>
<blockquote>
<p>PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, and more</p>
</blockquote>
<p>翻译成中文的意思如下：</p>
<blockquote>
<p>PostCSS 是一套利用JS插件实现的用来改变CSS的工具.这些插件能够支持变量和混合语法，转换未来CSS语法，内联图片，还有更多</p>
</blockquote>
<p>我们用过<code>Less</code>、<code>SASS</code>等工具来对CSS做<code>预处理</code>操作，按照它们约定的语法来书写并且最终转换成可用的样式，这付出的代价是<strong>必须先熟悉这个工具的书写语法</strong>。 </p>
<p>随着近几年 <a href="http://gruntjs.cn/" target="_blank" rel="external">Grunt</a>、<a href="http://gulpjs.com/" target="_blank" rel="external">Gulp</a>、<a href="http://webpack.github.io/docs/" target="_blank" rel="external">Webpack</a> 等自动化工具的兴起，<code>组合式应用</code>变得非常的热门，那<code>PostCSS</code>存在的意义是什么呢？答案是：<strong>CSS生态系统</strong></p>
<p><code>PostCSS</code>拥有非常多的插件，诸如自动为CSS添加浏览器前缀的插件<code>autoprefixer</code>、当前移动端最常用的<code>px</code>转<code>rem</code>插件<code>px2rem</code>，还有支持尚未成为CSS标准但特定可用的插件<code>cssnext</code>，还有很多很多。就连著名的<code>Bootstrap</code>在下一个版本<code>Bootstrap 5</code>也将使用<code>PostCSS</code>作为样式的基础。</p>
<p>一句话来概括PostCSS：<strong>CSS编译器能够做到的事情，它也可以做到，而且能够做得更好</strong></p>
<h2 id="快速使用PostCSS" class="post-heading"><a href="#快速使用PostCSS" class="headerlink" title="快速使用PostCSS"></a>快速使用PostCSS<a class="post-anchor" href="#快速使用PostCSS" aria-hidden="true"></a></h2><p>上面大致介绍了<code>PostCSS</code>，也许我们并没有在头脑里形成对它的认知，那下面我们就通过一个简单地实例来看看如何使用<code>PostCSS</code>。</p>
<p><code>PostCSS</code>得益于插件，支持Grunt,Gulp,webpack,Broccoli,Brunch还有ENB，这里我们将以<code>Gulp</code>作为实例来讲。</p>
<h3 id="环境准备" class="post-heading"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备<a class="post-anchor" href="#环境准备" aria-hidden="true"></a></h3><p>创建并进入我们的实例目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir postcss-demo &amp;&amp; <span class="built_in">cd</span> postcss-demo</span><br></pre></td></tr></table></figure>
<p>然后快速生成<code>package.json</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --yes 参数能够帮助我们快速生成默认的package.json</span></span><br><span class="line">npm init --yes</span><br></pre></td></tr></table></figure>
<p>将上面创建的<code>package.json</code>文件的<code>main</code>参数改为<code>gulpfile.js</code>，然后安装我们所需的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gulp跟gulp-postcss是必须的，后面两个插件为了演示用途</span></span><br><span class="line">npm i gulp gulp-postcss autoprefixer autoprefixer-core cssnext --save-dev <span class="_">-d</span></span><br></pre></td></tr></table></figure>
<p>创建<code>gulpfile.js</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里用命令行进行创建，你也可以手动新建</span></span><br><span class="line">touch gulpfile.js</span><br></pre></td></tr></table></figure>
<h3 id="修改gulpfile-js" class="post-heading"><a href="#修改gulpfile-js" class="headerlink" title="修改gulpfile.js"></a>修改gulpfile.js<a class="post-anchor" href="#修改gulpfile-js" aria-hidden="true"></a></h3><p>将下面代码贴进<code>gulpfile.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"><span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>);</span><br><span class="line"><span class="keyword">var</span> cssnext = <span class="built_in">require</span>(<span class="string">'cssnext'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义css任务</span></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//定义postcss任务流数组</span></span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">    autoprefixer(&#123;</span><br><span class="line">      browsers:[<span class="string">'last 3 version'</span>],</span><br><span class="line">      cascade: <span class="literal">false</span>,</span><br><span class="line">      remove: <span class="literal">false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    cssnext()</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="创建示例样式" class="post-heading"><a href="#创建示例样式" class="headerlink" title="创建示例样式"></a>创建示例样式<a class="post-anchor" href="#创建示例样式" aria-hidden="true"></a></h3><p>在项目根目录下创建src目录，再在src目录下面创建css目录，然后创建style.css文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里用命令创建，你也可以手动创建</span></span><br><span class="line">mkdir -p src/css &amp;&amp; touch style.css</span><br></pre></td></tr></table></figure>
<p>编辑样式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>:flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line"><span class="attribute">--fontSize</span>: <span class="number">1rem</span>;</span><br><span class="line"><span class="attribute">--mainColor</span>: <span class="number">#12345678</span>;</span><br><span class="line"><span class="attribute">--highlightColor</span>: <span class="built_in">hwb</span>(190, 35%, 20%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: <span class="built_in">var</span>(--mainColor);</span><br><span class="line"></span><br><span class="line"><span class="attribute">font-size</span>: <span class="built_in">var</span>(--fontSize);</span><br><span class="line"><span class="attribute">line-height</span>: <span class="built_in">calc</span>(var(--fontSize) * <span class="number">1.5</span>);</span><br><span class="line"><span class="attribute">padding</span>: <span class="built_in">calc</span>((var(--fontSize) / <span class="number">2</span>) + <span class="number">1px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="运行实例" class="post-heading"><a href="#运行实例" class="headerlink" title="运行实例"></a>运行实例<a class="post-anchor" href="#运行实例" aria-hidden="true"></a></h3><p>一切准备就绪之后可以在项目根目录下执行刚才我们定义的任务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp css</span><br></pre></td></tr></table></figure>
<p>如果不出什么意外的话就会在根目录下面生成一个<code>dist</code>文件夹，里面有一个样式文件，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>:-webkit-flex;</span><br><span class="line">  <span class="attribute">display</span>:-ms-flexbox;</span><br><span class="line">  <span class="attribute">display</span>:-webkit-box;</span><br><span class="line">  <span class="attribute">display</span>:flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">color</span>:<span class="number">#123456</span>;</span><br><span class="line"><span class="attribute">color</span>:<span class="built_in">rgba</span>(18, 52, 86, 0.47059);</span><br><span class="line"></span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">16px</span>;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">1rem</span>;</span><br><span class="line"><span class="attribute">line-height</span>:<span class="number">24px</span>;</span><br><span class="line"><span class="attribute">line-height</span>:<span class="number">1.5rem</span>;</span><br><span class="line"><span class="attribute">padding</span>:<span class="built_in">calc</span>(0.5rem + 1px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到我们写的样式自动添加了浏览器前缀，并且一些未来CSS语法也被转换了。</p>
<h2 id="了解PostCSS" class="post-heading"><a href="#了解PostCSS" class="headerlink" title="了解PostCSS"></a>了解PostCSS<a class="post-anchor" href="#了解PostCSS" aria-hidden="true"></a></h2><p>通过上面的实例我们应该知道<code>PostCSS</code>的使用方法，此时让我们先回想一下<code>CSS预处理器</code>的使用历程：</p>
<ol>
<li>学习该CSS预处理器的语法特性，诸如：变量定义、嵌套、继承</li>
<li>在特定后缀名(.less/.scss等)的文件按照上面的语法进行编写</li>
<li>通过Gulp/Grunt/Webpack等自动化工具或者手动编译成CSS样式</li>
</ol>
<p>而<code>PostCSS</code>的使用历程：</p>
<ol>
<li>直接按照CSS标准语法来书写CSS样式文件</li>
<li>通过Gulp/Grunt/Webpack等自动化工具加载PostCSS插件转换输出</li>
</ol>
<p>通过对比我们类比一个结论：<em>CSS预处理器好比给你一个工具箱，工具箱里面有什么东西该怎么拿已经跟你约定好，你必须按照这个规则来拿；而PostCSS好比给你一个盒子，你可以从旁边选择自己需要的工具放进盒子打包拿走，如果还不够用你可以自己造一个工具</em></p>
<h2 id="深入PostCSS" class="post-heading"><a href="#深入PostCSS" class="headerlink" title="深入PostCSS"></a>深入PostCSS<a class="post-anchor" href="#深入PostCSS" aria-hidden="true"></a></h2><p><code>PostCSS</code>自身只包括了<code>CSS分析器</code>，<code>CSS节点树API</code>，<code>source map生成器</code>，<code>CSS节点拼接器</code>，而基于<code>PostCSS</code>的插件都是使用了<code>CSS节点树API</code>来实现的。</p>
<p>我们都知道CSS的组成如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">element &#123;</span><br><span class="line">  prop1 : rule1 rule2 ...;</span><br><span class="line">  prop2 : rule1 rule2 ...;</span><br><span class="line">  prop2 : rule1 rule2 ...;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是一条一条的样式规则组成，每一条样式规则包含一个或多个属性跟值。所以<code>PostCSS</code>的执行过程大致如下：</p>
<ol>
<li><p>Parser<br> 利用<code>CSS分析器</code>读取CSS字符内容，得到一个完整的<code>节点树</code></p>
</li>
<li><p>Plugin<br> 对上面拿到的<code>节点树</code>利用<code>CSS节点树API</code>进行一系列的转换操作</p>
</li>
<li><p>Plugin<br> 利用<code>CSS节点拼接器</code>将上面转换之后的节点树重新组成CSS字符</p>
</li>
<li><p>Stringifier<br> 在上面转换期间可利用<code>source map生成器</code>表明转换前后字符的对应关系</p>
</li>
</ol>
<h3 id="PostCSS性能" class="post-heading"><a href="#PostCSS性能" class="headerlink" title="PostCSS性能"></a>PostCSS性能<a class="post-anchor" href="#PostCSS性能" aria-hidden="true"></a></h3><p>在PostCSS官方推特上看到，由JavaScript编写的PostCSS比C++编写的libsass还要快3倍，下面来自官方推特的截图:</p>
<p class="user_img"><img title="PostCSS性能对比图" class="test_img" src="/img/post/cnt1992/postcss.png" alt="PostCSS性能对比图"></p>
<p>如果你对上面的性能截图有疑问，可以亲自来<a href="https://github.com/postcss/benchmark" target="_blank" rel="external">这里</a>测试看看。</p>
<h3 id="开始编写自己的PostCSS插件" class="post-heading"><a href="#开始编写自己的PostCSS插件" class="headerlink" title="开始编写自己的PostCSS插件"></a>开始编写自己的PostCSS插件<a class="post-anchor" href="#开始编写自己的PostCSS插件" aria-hidden="true"></a></h3><p><code>PostCSS</code>在自己的<a href="https://github.com/postcss/postcss#plugins" target="_blank" rel="external">Github</a>上放了一些常用的插件，更多的插件可以在<a href="http://postcss.parts/" target="_blank" rel="external">postcss.parts</a>进行搜索。</p>
<p>但有时候已有的插件不满足我们的需求，这个时候需要编写自己的PostCSS插件，下面我们将一步步创建一个简单的插件，这个插件功能非常简单，如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span><br><span class="line">  文件位置：src/css/style.css</span><br><span class="line"> */</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"\5FAE\8F6F\96C5\9ED1"</span>,<span class="built_in">fontstack</span>(<span class="string">'Arial'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当输入上面的样式时，会生成下面的样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  文件位置：dist/style.css</span><br><span class="line"> */</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"\5FAE\8F6F\96C5\9ED1"</span>,tahoma,arial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="环境准备-1" class="post-heading"><a href="#环境准备-1" class="headerlink" title="环境准备"></a>环境准备<a class="post-anchor" href="#环境准备-1" aria-hidden="true"></a></h3><p>我们将以<code>Gulp</code>作为基础来实现我们的插件，首先创建项目文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir postcss-plugin &amp;&amp; <span class="built_in">cd</span> postcss-plugin</span><br></pre></td></tr></table></figure>
<p>然后快速创建<code>package.json</code>文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes</span><br></pre></td></tr></table></figure>
<p>紧接着先安装必备的包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gulp postcss gulp-postcss --save-dev <span class="_">-d</span></span><br></pre></td></tr></table></figure>
<p>再创建<code>gulpfile.js</code>并且输入下面内容:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="创建插件文件夹" class="post-heading"><a href="#创建插件文件夹" class="headerlink" title="创建插件文件夹"></a>创建插件文件夹<a class="post-anchor" href="#创建插件文件夹" aria-hidden="true"></a></h3><p>我们在执行<code>npm install</code>安装的包都放置在<code>node_modules</code>文件夹下面，这里我们创建PostCSS的插件文件夹，注意：<strong>PostCSS的插件命名格式为：postcss-插件名字</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里采用命令新建文件夹，你也可以手动创建</span></span><br><span class="line">mkdir node_modules/postcss-fontstack</span><br></pre></td></tr></table></figure>
<h3 id="创建插件入口文件" class="post-heading"><a href="#创建插件入口文件" class="headerlink" title="创建插件入口文件"></a>创建插件入口文件<a class="post-anchor" href="#创建插件入口文件" aria-hidden="true"></a></h3><p>现在我们可以在<code>postcss-fontstack</code>文件夹创建入口文件<code>index.js</code>，<code>PostCSS</code>创建插件的方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'postcss'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = postcss.plugin(<span class="string">'插件名字'</span>, <span class="function"><span class="keyword">function</span> 插件名字(<span class="params">选项</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//这里写插件代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>那我们可以在<code>index.js</code>里面贴入下面代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'postcss'</span>);</span><br><span class="line"></span><br><span class="line">modules.exports = postcss.plugin(<span class="string">'fontstack'</span>, <span class="function"><span class="keyword">function</span> <span class="title">fontstack</span>(<span class="params"> options </span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"> css </span>)</span>&#123;</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fontstack_config = &#123;</span><br><span class="line">      <span class="string">'Arial'</span>: <span class="string">'tahoma,arial'</span>,</span><br><span class="line">      <span class="string">'Times New Roman'</span>: <span class="string">'TimesNewRoman, "Times New Roman", Times, Baskerville, Georgia, serif'</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">toTitleCase</span>(<span class="params"> str </span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> str.replace(<span class="regexp">/\w\S*/g</span>,<span class="function"><span class="keyword">function</span>(<span class="params"> txt </span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> txt.charAt(<span class="number">0</span>).toUpperCase() + txt.substr(<span class="number">1</span>).toLowerCase();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// css.walkRules方法用来遍历每一条css规则</span></span><br><span class="line">    css.walkRules( <span class="function"><span class="keyword">function</span>(<span class="params"> rule </span>)</span>&#123;</span><br><span class="line">        <span class="comment">// walkDecls方法用来解析属性跟值</span></span><br><span class="line">        rule.walkDecls( <span class="function"><span class="keyword">function</span>(<span class="params"> decl, i </span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> value = decl.value;</span><br><span class="line">            <span class="keyword">if</span>( value.indexOf( <span class="string">'fontstack('</span> ) !== <span class="number">-1</span> )&#123;</span><br><span class="line">                <span class="keyword">var</span> fontstack_requested = value.match(<span class="regexp">/\(([^)]+)\)/</span>)[<span class="number">1</span>].replace(<span class="regexp">/["']/g</span>,<span class="string">""</span>);</span><br><span class="line">                fontstack_requested = toTitleCase( fontstack_requested );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> fontstack = fontstack_config[ fontstack_requested ];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> firstFont = value.substr( <span class="number">0</span>, value.indexOf(<span class="string">'fontstack('</span>) );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> newValue = firstFont + fontstack;</span><br><span class="line"></span><br><span class="line">                decl.value = newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在<code>gulpfile.js</code>引入上面的插件，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="运行实例-1" class="post-heading"><a href="#运行实例-1" class="headerlink" title="运行实例"></a>运行实例<a class="post-anchor" href="#运行实例-1" aria-hidden="true"></a></h3><p>在项目根目录下运行实例，最终实现我们的效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp css</span><br></pre></td></tr></table></figure>
<h2 id="再谈PostCSS" class="post-heading"><a href="#再谈PostCSS" class="headerlink" title="再谈PostCSS"></a>再谈PostCSS<a class="post-anchor" href="#再谈PostCSS" aria-hidden="true"></a></h2><p>基于<code>PostCSS</code>能够做到很多<code>CSS预处理器</code>做不到的事情，未来发展前景还是挺不错的，而且最新的<code>Atom</code>编辑器也可以下载插件来支持<code>PostCSS</code>这种语法。</p>
<p>但这就意味着<code>CSS预处理器</code>过时了么？不会。<code>PostCSS</code>的出现并不是为了替换掉之前的技术，只是提供多一种思路让我们去考虑，就比如Sass编译后再加<code>autoprefixer</code>自动补齐浏览器前缀这种做法当前还是比较流行的。</p>
<p>再回到文章最开始说的，<code>PostCSS</code>其实是在打造一个改变CSS开发方式的生态系统。也许暂时我们还是保持传统的开发方式，但未来对于<code>PostCSS</code>我还是保持关注，它是值得期待的。</p>

    </div>
    <div class="post-revision">
        <i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2016-03-31T02:31:36.000Z" itemprop="dateModified">上次更新：星期四, 3月31日 2016 02:31:36</time>
    </div>
    
<div class="actions pagination pagination-post">
    
    <div class="pagination-post-prev"><a href="/notes/2015/10/16/vim-list/" class="button big" title="我的vim二三事"><i class="fa fa-chevron-left"></i> 我的vim二三事</a></div>
    
    
    <div class="pagination-post-next"><a href="/notes/2015/10/08/aotu-blog-v1/" class="button big" title="凹凸实验室博客V1.0.0发布">凹凸实验室博客V1.0.0发布 <i class="fa fa-chevron-right"></i></a></div>
    
</div>


    


<div class="post-comments" id="comments">
<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="bm90ZXMvMjAxNS8xMC8xMy9zdGFydC1wb3N0Y3NzLw==" data-title="PostCSS快速入门使用" data-url="http://aotu.io/notes/2015/10/13/start-postcss/index.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {short_name:"aotu"};
    (function() {
        var ds = document.createElement('script');
        ds.id = "duoshuo-script";
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->



</div>


</article>

</div>
<div class="sec sec-follow-lite">
    <div class="container">
        <div class="sec-heading">
            <p class="follow-pic"><img src="/img/qrcode.png" alt="关注我们"/></p>
            <p class="follow-desc">海海人生，无折腾不为乐。</p>
            <p class="sec-heading-sub follow-acount">
                <img class="follow-icon" src="/img/logo-circle-120.png" alt="AOTULabs"/> 微信号：AOTULabs
            </p>
        </div>
    </div>
</div>

<div class="sec sec-footer">
    <div class="container">
        <footer id="footer" class="sec-heading footer">
            <ul class="icons">
                <li><a href="https://twitter.com/o2circle" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a></li>
                <li><a href="/atom.xml" class="footer-link fa-rss"><span class="label">RSS</span></a></li>
                <li><a href="https://github.com/o2team/o2team.github.io" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a></li>
            </ul>
            <div class="footer-sec copyright">
            &copy; 2016 <a href="http://aotu.io" target="_blank">凹凸实验室</a><br>
            Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
            </div>
            <div class="footer-sec words">
            "
            
            
            
            After a storm comes a calm.
            
            "
            </div>
            
            <div class="footer-sec site-stats" style="display:none">
                <span id="busuanzi_container_site_pv" class="site-pv">
                    总访问量: <span id="busuanzi_value_site_pv" class="site-pv-num"></span> 次
                </span>
                <span id="busuanzi_container_site_uv" class="site-uv">
                    总访客数: <span id="busuanzi_value_site_uv" class="site-uv-num"></span> 人
                </span>
            </div>
            
        </footer>
    </div>
</div>


    
    <section id="smSearch" class="slide-search">

<!-- Search -->
    <section>
        <form class="search" method="get">
            <input type="text" name="query" placeholder="搜索" />
        </form>
    </section>

<!-- Links -->
    <section>
		<h3>搜索结果</h3>
        <ul class="links" id="searchResults">Loading...</ul>
    </section>

</section>

<script id="tplSearch" type="text/hogan-tpl">
    {{#items}}
    <li>
        <a href="{{ url }}" target="_blank">
            <h3>{{ title }}</h3>
            {{#desc}}
			<p>{{ desc }}</p>
			{{/desc}}
        </a>
    </li>
    {{/items}}
</script>


    
	
	<div class="back-to-top" id="backTop"><i class="fa fa-long-arrow-up"></i></div>
	
    
    <!-- Scripts -->
<!-- build:js js/dist.o2.js -->
<script src="/js/lunr.js"></script>
<script src="/js/debounce.js"></script>
<script src="/js/jquery.js"></script>
<script src="/js/xhogan.js"></script>
<script src="/js/hammer.js"></script>
<script src="/assets/bootstrap/js/bootstrap.js"></script>
<script src="/js/lang_select.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/mobile_nav.js"></script>
<script src="/js/util.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script>

<script src="/assets/fancybox/jquery.fancybox.js"></script>
<script src="/js/fancybox.js"></script>

<!-- endbuild -->


<!-- build:js js/dist.duoshuo.js -->
<script src="/js/ua-parser.min.js"></script>
<script src="/js/duoshuo.js"></script>
<!-- endbuild -->



<!--busuanzi-->
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


    
</body>
</html>
